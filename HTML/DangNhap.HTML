<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tạo tài khoản</title>
    <link
      rel="stylesheet"
      href="../bootstrap-5.3.3-dist/css/bootstrap.min.css"
    />
    <script src="../jquery/jquery-3.7.1.js"></script>
    <script src="../bootstrap-5.3.3-dist/js/bootstrap.min.js"></script>

    <style>
      * {
        box-sizing: border-box;
        margin: 0%;
      }
      .container {
        width: 100%; /* co dãn full width */
        height: 500px;
        margin: 0 auto; /* canh giữa */
        padding: 0 20px; /* khoảng cách hai bên */
        text-align: center;
      }

      /* --- Login box --- */
      .login-box {
        width: 400px;
        margin: 40px auto;
        text-align: center;
      }

      .tabs {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 20px;
        font-size: 22px;
      }
      .tabs span {
        margin: 0 10px;
        cursor: pointer;
        color: #888;
      }
      .tabs .active {
        font-weight: bold;
        color: #000;
      }
      .tabs .divider {
        color: #000;
      }

      .input-box {
        width: 100%;
        padding: 15px;
        margin: 10px 0 5px 0;
        border: none;
        background: #f2f2f2;
        font-size: 14px;
      }

      .error-text {
        color: red;
        font-size: 13px;
        text-align: left;
        margin-bottom: 8px;
        margin-left: 5px;
      }

      .btn-login {
        background: #f53684;
        border: none;
        padding: 12px 20px;
        color: #fff;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        border-radius: 4px;
        margin-top: 10px;
      }

      .extra-links {
        font-size: 14px;
        text-align: left;
        margin-top: 10px;
      }
      .extra-links a {
        color: #0aa;
        text-decoration: none;
      }
      .extra-links a:hover {
        text-decoration: underline;
      }

      .form {
        display: none;
      }
      .form.active {
        display: block;
      }
    </style>
  </head>

  <body>
    <div class="nav">
      <iframe
        src="../HTML/nav.html"
        frameborder="0"
        width="100%"
        height="170px"
      ></iframe>
    </div>
    <div class="container">
      <div class="login-box">
        <div class="tabs">
          <span id="tab-dangnhap" class="active" onclick="hienForm('dangnhap')"
            >Đăng nhập</span
          >
          <span class="divider">|</span>
          <span id="tab-dangky" onclick="hienForm('dangky')">Đăng ký</span>
        </div>

        <!-- FORM ĐĂNG NHẬP -->
        <div id="form-dangnhap" class="form active">
          <input
            id="dn-sdt"
            type="text"
            class="input-box"
            placeholder="Nhập số điện thoại"
          />
          <div id="err-dn-sdt" class="error-text"></div>

          <input
            id="dn-mk"
            type="password"
            class="input-box"
            placeholder="Nhập mật khẩu"
          />
          <div id="err-dn-mk" class="error-text"></div>

          <button class="btn-login" onclick="kiemTraDangNhap()">
            ĐĂNG NHẬP
          </button>

          <div class="extra-links">
            <p><a href="#">Quên mật khẩu?</a></p>
            <p>
              Chưa có tài khoản?
              <a href="#" onclick="hienForm('dangky')">Đăng ký</a>
            </p>
          </div>
        </div>

        <!-- FORM ĐĂNG KÝ -->
        <div id="form-dangky" class="form">
          <input
            id="dk-sdt"
            type="text"
            class="input-box"
            placeholder="Nhập số điện thoại"
          />
          <div id="err-dk-sdt" class="error-text"></div>

          <input
            id="dk-email"
            type="text"
            class="input-box"
            placeholder="Nhập email"
          />
          <div id="err-dk-email" class="error-text"></div>

          <input
            id="dk-mk"
            type="password"
            class="input-box"
            placeholder="Nhập mật khẩu"
          />
          <div id="err-dk-mk" class="error-text"></div>

          <input
            id="dk-lai-mk"
            type="password"
            class="input-box"
            placeholder="Nhập lại mật khẩu"
          />
          <div id="err-dk-lai-mk" class="error-text"></div>

          <button class="btn-login" onclick="kiemTraDangKy()">ĐĂNG KÝ</button>

          <div class="extra-links">
            <p>
              Đã có tài khoản?
              <a href="#" onclick="hienForm('dangnhap')">Đăng nhập</a>
            </p>
          </div>
          <div class="dskh">
            <button class="link-primary">
              <a href="../HTML/dsKh.html" style="text-decoration: none"
                >Danh sách khách hàng</a
              >
            </button>
          </div>
        </div>
      </div>
    </div>
    <iframe
      src="../HTML/footer.html"
      frameborder="0"
      width="100%"
      height="295px"
    ></iframe>

    <script>
      // Hiển thị form
      function hienForm(loai) {
        document
          .getElementById("tab-dangnhap")
          .classList.toggle("active", loai === "dangnhap");
        document
          .getElementById("tab-dangky")
          .classList.toggle("active", loai === "dangky");
        document
          .getElementById("form-dangnhap")
          .classList.toggle("active", loai === "dangnhap");
        document
          .getElementById("form-dangky")
          .classList.toggle("active", loai === "dangky");
      }

      // Regex kiểm tra hợp lệ
      function kiemTraSoDienThoai(sdt) {
        return /^0\d{9}$/.test(sdt);
      }
      function kiemTraEmail(email) {
        return /^[^\s@]+@gmail\.com$/.test(email);
      }

      // Đăng ký tài khoản
      function kiemTraDangKy() {
        const sdt = document.getElementById("dk-sdt").value.trim();
        const email = document.getElementById("dk-email").value.trim();
        const mk = document.getElementById("dk-mk").value.trim();
        const laiMk = document.getElementById("dk-lai-mk").value.trim();

        let hopLe = true;

        document
          .querySelectorAll(".error-text")
          .forEach((e) => (e.textContent = ""));

        if (!kiemTraSoDienThoai(sdt)) {
          document.getElementById("err-dk-sdt").textContent =
            "Số điện thoại không hợp lệ (10 số, bắt đầu bằng 0)";
          hopLe = false;
        }
        if (!kiemTraEmail(email)) {
          document.getElementById("err-dk-email").textContent =
            "Email không hợp lệ";
          hopLe = false;
        }
        if (mk.length < 6) {
          document.getElementById("err-dk-mk").textContent =
            "Mật khẩu phải có ít nhất 6 ký tự";
          hopLe = false;
        }
        if (mk !== laiMk) {
          document.getElementById("err-dk-lai-mk").textContent =
            "Mật khẩu nhập lại không khớp";
          hopLe = false;
        }

        if (hopLe) {
          // Lấy danh sách người dùng hiện có (nếu có)
          let dsNguoiDung = JSON.parse(localStorage.getItem("nguoiDung")) || [];

          // Kiểm tra trùng SDT
          if (dsNguoiDung.some((u) => u.sdt === sdt)) {
            alert("Số điện thoại này đã được đăng ký!");
            return;
          }

          // Thêm người dùng mới
          const nguoiDung = { sdt, email, mk };
          dsNguoiDung.push(nguoiDung);

          // Lưu lại vào localStorage
          localStorage.setItem("nguoiDung", JSON.stringify(dsNguoiDung));

          alert("Đăng ký thành công!");
          // window.location.href = "dsKh.html";
        }
      }

      // Đăng nhập
      function kiemTraDangNhap() {
        const sdt = document.getElementById("dn-sdt").value.trim();
        const mk = document.getElementById("dn-mk").value.trim();

        const dsNguoiDung = JSON.parse(localStorage.getItem("nguoiDung")) || [];

        const tonTai = dsNguoiDung.find((u) => u.sdt === sdt && u.mk === mk);

        document.getElementById("err-dn-sdt").textContent = "";
        document.getElementById("err-dn-mk").textContent = "";

        if (!tonTai) {
          document.getElementById("err-dn-mk").textContent =
            "Sai số điện thoại hoặc mật khẩu!";
        } else {
          alert("Đăng nhập thành công!");
          window.location.href = "dsKh.html";
        }
      }
    </script>
  </body>
</html>
